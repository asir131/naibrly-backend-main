          finalPrice: finalPrice,
          discountPercent: updatedBundle.bundleDiscount,
        };
        updatedBundle.finalPrice = finalPrice;

        await updatedBundle.save();
        console.log("üí∞ Updated bundle pricing with provider rates:", {
          totalPrice,
          discountAmount,
          finalPrice,
          services: updatedBundle.services,
        });
      }

      // Create a SINGLE conversation for the bundle
      try {
        const existingConversation = await Conversation.findOne({
          bundleId: bundle._id,
        });

        if (!existingConversation) {
          // Create one conversation for the bundle creator with provider
          const conversation = new Conversation({
            customerId: bundle.creator, // Bundle creator is the main customer
            providerId: bundle.provider,
            bundleId: bundle._id,
            messages: [],
            isActive: true,
          });
          await conversation.save();
          console.log("‚úÖ Created bundle conversation:", conversation._id);
        } else {
          console.log("‚úÖ Bundle conversation already exists");
        }
      } catch (conversationError) {
        console.error("‚ùå Conversation creation error:", conversationError);
        // Don't fail the whole request if conversation creation fails
      }
    } else if (status === "declined") {
      statusNote =
